<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebSec Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; margin: 24px; max-width: 900px; }
    input, button, textarea { font-size: 14px; padding: 8px; margin: 4px 0; width: 100%; }
    .row { display:flex; gap:12px; }
    pre { background:#f5f5f5; padding:12px; overflow:auto; }
    .two { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  </style>
</head>
<body>
  <h1>Web Application Security Demo</h1>
  <p>Use the forms below to test both <strong>vulnerable</strong> and <strong>secure</strong> endpoints.</p>

  <div class="two">
    <section>
      <h2>Vulnerable Search (SQLi & Reflected XSS)</h2>
      <form id="vulnForm">
        <label>q (try: <code>alice' OR '1'='1</code> or <code>&lt;script&gt;alert('xss')&lt;/script&gt;</code>)</label>
        <input id="vuln_q" name="q" placeholder="search term" />
        <button type="submit">Search VULN</button>
      </form>
      <div id="vulnRes"></div>
    </section>

    <section>
      <h2>Secure Search</h2>
      <form id="secForm">
        <label>q (try same payloads)</label>
        <input id="sec_q" name="q" />
        <button type="submit">Search SECURE</button>
      </form>
      <div id="secRes"></div>
    </section>
  </div>

  <hr />
  <h3>Add user (secure)</h3>
  <form id="addForm">
    <input id="username" placeholder="username (3-30 chars)" required />
    <textarea id="bio" placeholder="bio"></textarea>
    <button type="submit">Add User</button>
  </form>
  <div id="addRes"></div>

  <hr />
  <h3>Demo quick commands</h3>
  <button id="runDdos">Simulate a DDoS (run local ddos_simulator.js separately)</button>
  <p>Open browser console to see fetch results; server has rate limiter so only 10 requests per 10s will pass from same IP.</p>

<script>
document.getElementById('vulnForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const q = document.getElementById('vuln_q').value;
  const res = await fetch('/vulnerable/search?q=' + encodeURIComponent(q));
  const text = await res.text();
  document.getElementById('vulnRes').innerHTML = text;
});
document.getElementById('secForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const q = document.getElementById('sec_q').value;
  const res = await fetch('/secure/search?q=' + encodeURIComponent(q));
  const text = await res.text();
  document.getElementById('secRes').innerHTML = text;
});
document.getElementById('addForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('username').value;
  const bio = document.getElementById('bio').value;
  const res = await fetch('/secure/add-user', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, bio })
  });
  const json = await res.json();
  document.getElementById('addRes').innerText = JSON.stringify(json, null, 2);
});
</script>
</body>
</html>
